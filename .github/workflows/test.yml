name: Test
on: 
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

env:
  GO_VERSION: 1.17.6
  UPSTREAM_REPO: https://github.com/golang/go.git

jobs:
  lint:
    name: Hashtest
    runs-on: ubuntu-latest
    steps:
      - name: Check out code into the Go module directory
        uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2.4.0
        
      - name: Get commit short hash from remote repo
        id: get-hash
        #run: git ls-remote https://github.com/golang/go.git HEAD | awk '{print $1}' | head -c 8
        #run: echo "::set-output name=hash::$(git ls-remote https://github.com/golang/go.git HEAD | awk '{print $1}' | head -c 8)"
        #run: echo "::set-output name=hash::$(git ls-remote ${{ env.UPSTREAM_REPO }} HEAD | awk '{print $1}' | head -c 8)"
        run: echo "::set-output name=hash::$(git ls-remote ${{ env.UPSTREAM_REPO }} HEAD | cut -f1 | head -c 8)"
      
      - name: Print the output
        run: echo "${{ steps.get-hash.outputs.hash }}"

        # https://pakstech.com/blog/github-actions-workflow-commands/
      - name: Print the output (using env variable)
        run: echo "$HASH"
        env:
          HASH: ${{ steps.get-hash.outputs.hash }}
